<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="icon" type="image/png" href="assets/images/logo2.PNG">
    <title>Davao Blue Eagle Scout - Cirva A La Gente Por La Musica</title>
    <link href="https://fonts.googleapis.com/css?family=Poppins:300,400,500,600,700,800,900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Inter:300,400,500,600,700,800,900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="assets/plugins/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="assets/plugins/font-awesome/css/all.min.css" rel="stylesheet">
    <link href="assets/css/style.css" rel="stylesheet">
    <link href="assets/css/custom.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script type="text/javascript">
    if (!localStorage.getItem("user")) {
        window.location.href = "login";
    }    

    document.addEventListener("DOMContentLoaded", function() {
    const currentUrl = window.location.href;
    const links = document.querySelectorAll('.accordion-menu a');

    links.forEach(link => {
        if (currentUrl.includes(link.getAttribute('href'))) {
            link.classList.add('active');
        }
    });
});


</script>
    
    </head>
    <body>
        <div style="position: fixed;top: 0px;left: 0px;width: 100%;background: #F4F7FC;z-index: 9999;padding: 0px;">
  <div class="lime-sidebar">
    <div class="lime-sidebar-inner slimscroll">
      <ul class="accordion-menu">
        <li class="sidebar-title">Navigations</li>
        <li><a href="dashboard"><i class="material-icons">dashboard</i><span>Dashboard</span></a></li>
        <li><a href="events"><i class="material-icons">event</i><span>Events</span></a></li>
        
        <li><a href="revenues"><i class="material-icons">trending_up</i><span>Revenues</span></a></li>
        <li><a href="payments"><i class="material-icons">payment</i><span>Payments</span></a></li>
        <li><a href="expenses"><i class="material-icons">request_quote</i><span>Expenses</span></a></li>
        <li><a href="attendance"><i class="material-icons">schedule</i><span>Attendance</span></a></li>
        <li><a href="users"><i class="material-icons">people</i><span>Users</span></a></li>
      </ul>
      <ul class="accordion-menu" id="Othersnav">
        <li class="divider"></li>
        <li class="sidebar-title">Others</li>
        <li><a href="account"><i class="material-icons">settings</i><span>Account</span></a></li>
        <li><a onclick="localStorage.removeItem('user'); window.location.href = 'login';"><i class="material-icons">power_settings_new</i><span>Logout</span></a></li>
      </ul>
    </div>
  </div>

  <style>
    @media (max-width: 1024px) {
      #Othersnav {
        display: block;
      }
    }
    @media (min-width: 1025px) {
      #Othersnav {
        display: none;
      }
    }
  </style>

  <div class="lime-header" style="padding: 0px;">
    <nav class="navbar navbar-expand-lg">
      <section class="material-design-hamburger navigation-toggle">
        <a href="javascript:void(0)" class="button-collapse material-design-hamburger__icon">
          <span class="material-design-hamburger__layer"></span>
        </a>
      </section>
      <a class="navbar-brand" href="">
        <img src="assets/images/logo2.png" style="height: 75px;width: 75px;">
      </a>
      <button class="navbar-toggler" type="button"  style="margin-right: 10px" onclick="localStorage.removeItem('user'); window.location.href = 'login';">
        <i class="material-icons" style="font-size: 20px;">power_settings_new</i>
      </button>
      <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <ul class="navbar-nav ml-auto">
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
              <i class="material-icons">more_vert</i>
            </a>
            <ul class="dropdown-menu dropdown-menu-right">
              <li><a class="dropdown-item" href="account">Account</a></li>
              <li><a class="dropdown-item" onclick="localStorage.removeItem('user'); window.location.href = 'login';">Log Out</a></li>
            </ul>
          </li>
        </ul>
      </div>
    </nav>
  </div>
</div>

            

        <div class="lime-container">
            <div class="lime-body" style="margin-top:100px">
                <div class="container">


                        
                    <div class="row">

                        <div class="col">

                            <div class="card">
                                <div class="card-body">
                                      <h5 class="card-title" style="text-align: center;">(<span style="color:#07102F" id="totalRows"></span>) Expenses</h5>
    
                                    <div class="row">
<div class="col-12 col-md-12">
    <div class="todo-sidebar">
        <div class="row">
            <div class="col-12 col-md-6 mb-3">
                <div class="todo-new-task">
                    <button class="btn btn-primary btn-block" style="height:42px;" data-toggle="modal" data-target="#newUsers">Create New Expenses</button>
                </div>
            </div>

            <div class="col-12 col-md-6 mb-3">
                <div class="todo-search m-b-lg">
                        <div class="input-group">
                            <input type="text" id="search" class="form-control" placeholder="Search Expenses">
                        </div>
                </div>
            </div>
        </div>
    </div>
</div>

                                        <div class="col-md-12">
                                              

                    <div class="row">
                        
                        <div class="col-md-6">
                            <div class="card stat-card">
                                <div class="card-body bg-info">
                                    <h5 class="card-title">Total Amount</h5>
                                    <h2 class="float-right" id="TotalAmount" style="color:white;"></h2>
                                    <p style="color:white;font-weight: bold;">PHP</p>
                                    
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card stat-card">
                                <div class="card-body bg-success">
                                    <h5 class="card-title">Total Amount Given</h5>
                                    <h2 class="float-right" id="TotalAmountGiven" style="color:white;"></h2>
                                    <p style="color:white;font-weight: bold;">PHP</p>
                                    
                                </div>
                            </div>
                        </div>
                    </div>

<div class="card">
    <div class="card-body" style="padding: 0px;">
        <div class="table-responsive">
            <table class="table">
        <thead>
            <tr>
                <th>Date Encoded</th>
                <th>Description</th>
                <th>Amount</th>
                <th>Date Used</th>
                <th>Amount Given</th>
                <th>Date Given</th>
                <th>Officer</th>
                <th>Event</th>
            </tr>
        </thead>
        <tbody id="expensesTableBody"></tbody>
    </table>

        </div>
    </div>
</div>








                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>






            <div class="lime-footer">
                <div class="container">
                    <div class="row">
                        <div class="col-md-12">
                            <span class="footer-text">2025 Â© Davao Blue Eagle Scout</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Edit Expense Modal -->
<div class="modal fade" id="editExpenseModal" tabindex="-1" role="dialog" aria-labelledby="editExpenseModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editExpenseModalLabel">Edit Expense</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <i class="material-icons">close</i>
                </button>
            </div>
            <div class="modal-body">
                <form id="editExpenseForm">
                    <input type="hidden" id="editExpenseID">

                    <div class="form-group">
                        <label for="editDescription">Description</label>
                        <input type="text" class="form-control" id="editDescription" required>
                    </div>

                    <div class="form-group">
                        <label for="editAmount">Amount</label>
                        <input type="number" class="form-control" id="editAmount" required>
                    </div>

                    <div class="form-group">
                        <label for="editDateUsed">Date Used</label>
                        <input type="date" class="form-control" id="editDateUsed">
                    </div>

                    <div class="form-group">
                        <label for="editAmountGiven">Amount Given</label>
                        <input type="number" class="form-control" id="editAmountGiven">
                    </div>

                    <div class="form-group">
                        <label for="editDateGiven">Date Given</label>
                        <input type="date" class="form-control" id="editDateGiven">
                    </div>

                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-primary">Save Changes</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>


        

        <div class="modal fade" id="newUsers"  role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true" style="z-index: 99999999;background: rgba(0, 0, 0, 0.5);">
                                                        <div class="modal-dialog" role="document" >
                                                            <div class="modal-content">
                                                                <div class="modal-header">
                                                                    <h5 class="modal-title" id="exampleModalLabel">New User</h5>
                                                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                                        <i class="material-icons">close</i>
                                                                    </button>
                                                                </div>
                                                                <div class="modal-body">
                                                                    <form id="signupForm">
        <div class="form-group">
            <input type="text" class="form-control" id="firstName" required placeholder="First Name">
        </div>
        <div class="form-group">
            <input type="text" class="form-control" id="lastName" required placeholder="Last Name">
        </div>
        <div class="form-group">
            <input type="number" class="form-control" id="contactNumber" required placeholder="Contact Number">
        </div>
        <div class="form-group">
            <input type="text" class="form-control" id="position" required placeholder="Position">
        </div>
        <div class="form-group">
            <input type="text" class="form-control" id="userName" required placeholder="Username">
        </div>
        <div class="form-group">
            <input type="password" class="form-control" id="password" required placeholder="Password">
        </div>

        <div class="modal-footer" style="padding-right: 0px;">
                                                                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                                                                    <button type="submit" class="btn btn-primary">Add New User</button>
                                                                </div>
    </form>
                                                                </div>
                                                                
                                                            </div>
                                                        </div>
                                                    </div>


    <div class="modal fade" id="editUsers" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true" style="z-index: 99999999;background: rgba(0, 0, 0, 0.5);">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Edit User</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <i class="material-icons">close</i>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="editForm">
                        <div class="form-group">
                            <label for="editUsername">Username</label>
                            <input type="text" class="form-control" id="editUsername" name="editUsername" readonly>
                            <input type="hidden" class="form-control" id="editPersonID" name="PersonID" readonly>

                            
                        </div>
                        <div class="form-group">
                            <label for="editFirstName">First Name</label>
                            <input type="text" class="form-control" id="editFirstName" name="editFirstName">
                        </div>
                        <div class="form-group">
                            <label for="editLastName">Last Name</label>
                            <input type="text" class="form-control" id="editLastName" name="editLastName">
                        </div>
                        <div class="form-group">
                            <label for="editContactNumber">Contact #</label>
                            <input type="text" class="form-control" id="editContactNumber" name="editContactNumber">
                        </div>
                        <div class="form-group">
                            <label for="editRoleDescription">Role</label>
                            <input type="text" class="form-control" id="editRoleDescription" name="editRoleDescription">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="saveChangesBtn">Save Changes</button>
                </div>
            </div>
        </div>
    </div>
</div>



    
<script>
    $(document).ready(function () {
        $.get("/allexpenses", function (response) {
            if (response.status === "success") {
                let rows = "";
    
                let totalRows = 0;
                let totalAmount = 0;
                let totalAmountGiven = 0;
    
                response.data.forEach(expense => {
                    const formatDate = (dateString) => {
                        if (!dateString) return '';
                        const date = new Date(dateString);
                        return date.toLocaleDateString('en-US', {
                            year: 'numeric',
                            month: 'long',
                            day: 'numeric'
                        });
                    };
    
                    totalRows++;
                    totalAmount += parseFloat(expense.Amount) || 0;
                    totalAmountGiven += parseFloat(expense.AmountGiven) || 0;
    
                    rows += `<tr data-id="${expense.ExpenseID}">
                                <td>${formatDate(expense.DateEncoded)}</td>
                                <td>${expense.Description || ''}</td>
                                <td>${expense.Amount}</td>
                                <td>${formatDate(expense.DateUsed)}</td>
                                <td>${expense.AmountGiven || ''}</td>
                                <td>${formatDate(expense.DateGiven)}</td>
                                <td>${expense.RoleDescription || ''} ${expense.PersonFirstName || ''} ${expense.PersonLastName || ''}</td>
                                <td>${expense.EventName || ''}</td>
                                <td>
                                    <button class="btn btn-secondary btn-sm edit-btn" data-id="${expense.ExpenseID}" 
                                        data-description="${expense.Description}" data-amount="${expense.Amount}" 
                                        data-dateused="${expense.DateUsed}" data-amountgiven="${expense.AmountGiven}" 
                                        data-dategiven="${expense.DateGiven}">
                                        Edit
                                    </button>
                                    <button class="btn btn-danger btn-sm delete-btn" data-id="${expense.ExpenseID}">Delete</button>
                                </td>
                            </tr>`;
                });
    
                $("#expensesTableBody").html(rows);
                $('#totalRows').text(totalRows);
                $('#TotalAmount').text(totalAmount.toFixed(2));
                $('#TotalAmountGiven').text(totalAmountGiven.toFixed(2));
    
            } else {
                alert("Error fetching expenses: " + response.message);
            }
        });
    
        // Handle Edit Button Click
        $(document).on("click", ".edit-btn", function () {
            const expenseId = $(this).data("id");
            const description = $(this).data("description");
            const amount = $(this).data("amount");
            const dateUsed = $(this).data("dateused");
            const amountGiven = $(this).data("amountgiven");
            const dateGiven = $(this).data("dategiven");
    
            $("#editExpenseID").val(expenseId);
            $("#editDescription").val(description);
            $("#editAmount").val(amount);
            $("#editDateUsed").val(dateUsed);
            $("#editAmountGiven").val(amountGiven);
            $("#editDateGiven").val(dateGiven);
    
            $("#editExpenseModal").modal("show");
        });
    
        // Handle Update Expense Submission
        $("#editExpenseForm").submit(function (event) {
            event.preventDefault();
    
            const updatedExpense = {
                ExpenseID: $("#editExpenseID").val(),
                Description: $("#editDescription").val(),
                Amount: $("#editAmount").val(),
                DateUsed: $("#editDateUsed").val(),
                AmountGiven: $("#editAmountGiven").val(),
                DateGiven: $("#editDateGiven").val(),
            };
    
            $.ajax({
                url: "/updateExpense",
                method: "POST",
                contentType: "application/json",
                data: JSON.stringify(updatedExpense),
                success: function (response) {
                    alert(response.message);
                    location.reload();
                },
                error: function (error) {
                    alert("Error updating expense.");
                }
            });
        });
    
        // Handle Delete Button Click
        $(document).on("click", ".delete-btn", function () {
            const expenseId = $(this).data("id");
            if (confirm("Are you sure you want to delete this expense?")) {
                $.ajax({
                    url: `/deleteExpense/${expenseId}`,
                    method: "DELETE",
                    success: function (response) {
                        alert(response.message);
                        location.reload();
                    },
                    error: function () {
                        alert("Error deleting expense.");
                    }
                });
            }
        });
    });
    </script>    


        <!-- Javascripts -->
        <script src="assets/plugins/jquery/jquery-3.1.0.min.js"></script>
        <script src="assets/plugins/bootstrap/popper.min.js"></script>
        <script src="assets/plugins/bootstrap/js/bootstrap.min.js"></script>
        <script src="assets/plugins/jquery-slimscroll/jquery.slimscroll.min.js"></script>
        <script src="assets/js/lime.min.js"></script>
        <script src="assets/js/pages/todo.js"></script>
    </body>
</html>





